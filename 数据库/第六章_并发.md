并发控制
共享性为并发访问提供前提条件

<font color=#66CC99 style=" font-weight:bold;">事务是数据库的基本单位</font>
事务是恢复和并发控制中的基本单位
不可分割
是一组程序序列

显式事务
以begin transaction开始
以commit(提交,事务正常结束)或
rollback(回滚,事务异常终止)结束

四大特性:能区分做选择就够
一致性是基于原子性的

#### 并发操作带来的数据不一致
选择题要会选
丢失修改(覆盖)
不可重复读,幻读(a线程操作数据过程中,b线程修改甚至删除->幻读)
读脏数据(回滚)
#### 锁
X锁,排它锁,写锁
不允许加其他锁
S锁,共享锁,读锁
可以再加S锁

封锁粒度,加锁范围:
对整个数据库加锁
对某个属性值加锁
加锁对象的大小称为封锁粒度

封锁粒度越大,并发性越低,系统消耗越小
小,高,大
![](img/Pasted%20image%2020221223221314.png)
死锁
特点:循环等待
对并发操作不加以控制会带来数据不一致问题
乱加锁才会带来死锁问题
![](img/Pasted%20image%2020221223221420.png)
#### 故障
事务故障
对系统没啥影响,分为两种:
预期事务故障:余额透支,商品没了
非预期事务故障:运算溢出,死锁

系统故障
内存丢失影响所有事务,但不破幻数据库
区别于事务故障,是所有事务都停止了

介质故障
磁盘物理数据都丢了
称为硬故障,需要DBA参与恢复
![](img/Pasted%20image%2020221223214918.png)

三种故障只有介质故障需要DBA参与
事务和系统故障恢复由系统自动完成

恢复(很少考)
对已经提交的事务REDO(重做)
对未提交的事务UNDO(撤销)
后援副本就是备份的数据
![](img/Pasted%20image%2020221223220925.png)

数据库恢复的基础是利用冗余数据,这些冗余数据主要指
日志文件(记录数据库每次更新),数据库后援副本(备份数据库)

备份(没考过)
完整备份
差异备份
事务日志备份(下图蓝框)
![](img/Pasted%20image%2020221223223045.png)
差异备份和事务日志备份都需要完整备份才能还原
用最后一次差异备份+完整备份能还原
需要所有的事务日志备份+完整备份能还原
